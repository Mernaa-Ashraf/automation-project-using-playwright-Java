import { test, expect, request } from '@playwright/test';

let token1

const payload = {
  email: "ashrafmerna8@gmail.com",
  logged: "false",
  password: "Fadysaber1!",
  recaptcha_token:"0cAFcWeA4D7H54LjNeplR7NHPDV4lrOOD9E9tM7dP9277O4VOqXn5L2YNsbbJukcmWkWDusoxNqOoALpdqQ5MQM_be9F2_MIRU4UgBqNHkgj8ksDicr3T1blUKru3GNNX_VNJ4O9pkoDVoeKdyUi9JnOt0iEcBbt13mZnlepRvlXDK1i-Hwhp34Ni0MGCXVqZbDUHH_nPuPmG6nsxeBgNlW23MxgqQXN_ZM1O8eNFfgICgYFLOSjEi7hPfBGkjHpEt6w27MA-ppGcC4eqJbcV1uAvsRNE2AgDSqZzNHMm32gKYX8gZe9KDRod2sbbhwVHXtlXXjA8uAAa3g6FMMTgrkPQWrHSUkf0c5oIX35M_wpFn21RKVsx4ItkBi6xjXWZ_VBxY1FJle2-ZlxH99Szu1XxNDZ8Y5fyW1vZAxen6x_-NDE-F_4oC3CGOogVt93v2uXDF1YOJby4f41fRteG16JXEipXwSQWCCZBQcoFQDb39FTWr48L41CN1v-hNMMayMJZ0ULYjzhqA65E6Ug0Lyo2HhJp872X9VbW46-pQHovsSS8LurxqWmRKo2670yTf8Q5CEc4K2pzfuMc_m6iInV2LxMG530RIdyRSzCsxaRBkTGWN9cZPPrFDiJYQynAAAG2i22AflwrczWHd9lqp_SNo2b4PeIvM7KjOIs3nbSTbW328jNRqMFxM5S7sGhSEeKnCSOadDH-ZI-zA_CzQ8ysZSTMvk4tuJ-zqk-rD-iQ6BC3ySyUuBWcSJ3TzT4vTTtJnjVDv_ha4A20Ic9rNIja8LscXpqv25oKjPZpVN0MwjQV0uLlvmJ2J8W1tEUjZRGE-UDYOwY4CMyWhC9xZwkgfZzl5p1FU1Y-GyiTkYJhfN4r2QPHiyMmqVYkQhXVIoxvPlq1dAuQNx7s7n6K2TvywdIzeEYmgZ2R6xhKHsXCYzrF5feaShIz1hAEh1eWUAE6O1gx1JLWIuMwhg9kJstch8gJ8BYUXSYnNMvZRhBNjysupGZiegLjSgh6H2gxgWflzP5kClIFtJsp2l2JNSzDvyQZ5IBcgx_4meHv9avFZfMvwmdr4xVduTnmS1Po7iJyts5Vn23KFq8rRSc8gsblc0pEpxQtEmEokfv0qu9vb8aSZ_UN7bsFxi_GYu-VJYYytNJqShF9r13hh5gLi0i_rD9ibCA_PpQYER9Rbr46o7Qe0r4NNI-cOdudvqo2Qa_WxOQmqK0y18othetmMyIpY1y_74hGd1aBOOGSCys9_yx3vvHPuavNDNZeQSD9sFEPflMiFyEMwY1zSOd31fuixDxW4wBBAAhm1mnP7RQv7DdQa1Qkf9UEJu8HWurRzCin6AeOB2k0u9HrrPEBpFBFpAOS_40xOuVjv6yYRcW_6r8jzAnZ5Ix_jLZesKj31XtuzPxgX2tGoEIyyVu8NT6FPf5aK5HG1rq59HdAt813uZHZlbYrW6STXViVCe8Nm467bNZUVAb5GBo5u3M5hwehOEe1HCj0wESDQkcPCEIj8PU9Zq8sMq0D7w7AcTh-9KOYQP6LJWLk11NeuLZmAbkeREN08nTWGULIBqpkcdWvI432EQWftCVc"
,token:"0cAFcWeA7OHo69zwabcat3XGD27cIemFoox39FBpioIpMXsjSPr2cVYRipkgTX2iECEHtNx1nZnvuAW71AHeOPzTvlpH6N9N_bVzgo7Uk-oMqE5vgKC8fEtGhECKBODe2hF07FWGOMH3aYvW7810GRAl2o1r1wDeQ_gKTgfDWNTsh8UxWBGwnZqw9BQyQNseVp7JeOaWdvYNpeOfM4PVTWQDeKRi2ThZ9byDpdgMw-bWd0uSQNq2Y3eaRw8H8tz0s9LY0_2bSbvjhKa6twubp1S16X0KoOokBYTD1IxIGUoeTDsAvDir1Oy2ufKQRQQsDpolevTno44I-kngp4OElJ8VmpUpctslqouaVaw8yQYkd9Z2YJ2-iNzqV77xT0uZ5WySkd9P_gijxNehORVqE_Xa1nf7fHlkEfi7uaMyQ_TH-yHra2pQAIUY3KZ-5D_GpR2iRQ7u3ZaFk1kaG95vBdF66Pidu0bPs0_xMnirj5b5wG8MjCWdYh07cB5pCipsWyrgipmwQHUeZHlFygomXbMbQDRoSdpEGhqLTnH3H6mEUYTjTiMzwnocbYp2u2aCPotcaL1HI40hDbpiMk1CLEgsFa1MsSb-uioOVS-ssPGi73kso7bYeVgE3hZ3KtKAEdfAdo9-BaqO9sq6HkSjAZyyNZagqrl6TsATeOsZBxFrBwmbf12ilPHRcY04ymQtyZha1l3jNe05_JAKmNpUQ95HdonSQNVseCyeQAnvjWX30SbLLYlz3oBM8yz_vNqj_5r5UH_1tzu4KrtMFIui9PcXmUbmb77-mp7NNRvW5rvB9Xj7w4uu7xq3mpxu745XXDCjngK6sadFl26o4y4xAhvxOYbhlTU7gnajk_JRvdAG7VrtQfLs_jTioCMxoVOBFYOaQ7Iv1Jfl3rhQvC5r6Bsbay7GSMJcvyYbu6YjbR1zQYi1JhJLtyezfgRMlTfs6yQiAyVPgv2xFPQTs4aRP9qFYNJ-Yn1CC5yvQgxjthmpnTKJwJ-WzPjvhYRU5OGZnoaAi_6TXST1PTQL9-NMa28iNHOg2S5waUZasT6gfAXsh2NqmlHPY4P-DnbwjjOrYcn_2dtLEUPOQGJ832Gb_2dvRvg03ZBh_ZWN84odFukFa1sUxs7UxdidJnCXhJgVHn6qxMAr5tBEinu477twtXO5kWItRmqgs4l4Mc1-tbGOX5iIhejT6zVUkuJW4LO2C0niX_Ybx6LqWFfA8KFN_YXd_XyPCUsQBDY2REr0tBPWEVx2VpXHJHhtEdZi95qBvAA5Z5ZaKUdadVuXcBMmfDrV9F2fodb83Z9t39vnuJ9meY4AdD5HB524Klj0W9jpAfDOiSBLI3P1GU8Hn-HC-quFKc8oUQCQgB6lpm7dlpVJQftZk776PkfqnH-PrOjFqmER-h1EjqoAUDpnhH5mQ9ZuBHilz10DibizezTxySh4TVnMBv-bGUgPIMrasWSMnXDJnyHfrX-i9r7GBpEytSINybY8Oprr0mH3VJMA0t8IYIr66Sft4S132WRwqIia_W2ejzQsPDzoqB2cXXIrEha_Ny3KumCHO7w92bj0QKk6IayxyOLAwqzMYBwpz4ytZlY8rs6Sf_vqlooOpqrGodUG-0o6ChKcsaLB899Am3i4IwYZdQ_U-8jqk"
};

test.beforeAll(async () => {
  const api = await request.newContext();

  const response = await api.post(
    "http://172.177.136.15:8080/api/v2/user/auth/regular/login",
    { data: payload }
  );

  expect(response.ok()).toBeTruthy();

  const responsejson = await response.json();
  token1 = responsejson.data.access_token; 

  console.log("TOKEN:", token1);
});

test.beforeEach(async ({ page }) => {
  await page.addInitScript(token => {
    localStorage.setItem('access_token', token);
  }, token1);
});

test("welcome text test", async ({ page }) => {
  await page.goto("http://172.177.136.15/your-portal?logged=true"); 

  const welcome = page.locator('xpath=//app-dashboard-header//h2/span');

  await expect(welcome).toContainText("welcome, merna!");
});
